<% provide(:title, @league.description) %>
<div class="center hero-unit">
  <p id="notice"><%= notice %></p>

  <h1><%= @league.description %></h1>

  <% if @matches and @matches.any?%>
      <%   matches_by_tier = @week.matches.group_by{ |match|
        team = match.team1
        standing = @standings.all.find_by(team: team)
        standing.tier if standing
      } %>


      <h2>Choose your tier:
        <% @week.tier_settings.each do |setting| %>
            <a onclick="showTier(<%= setting.tier%>, <%= @week.tier_settings.size %>);"> <%=setting.name || setting.tier%></a>
        <% end %>
        <a onclick="showTier(0, <%= @week.tier_settings.size %>);"> All tiers</a>
      </h2>

      <% @week.tier_settings.each do |setting|%>
          <div id = "show_tier<%=setting.tier%>">
            Results for <%=setting.name || setting.tier%> <br/>
            <% standings_by_tier = @week.standings.group_by{|standing| standing.tier}%>

            <% @tier_standings = standings_by_tier[setting.tier]%>
            <%= render 'matches/cross_results'%>

            <% @tier_matches = matches_by_tier[setting.tier]%>
            Schedule for tier#<%=setting.name || setting.tier%>  <br/>
            <div>
              <%= render 'matches/index'%>
            </div>

          </div>
      <%end%>
  <%else%>
      <h3>Registration is not finished yet</h3>
      <%
         @week = @league.weeks.find_by(week:nil)
         @standings = @week.standings if @week
      %>

      <%if @standings and @standings.any?%>
          <%= render "standings/index"%>
      <%end%>
  <%end%>

  <br/>
  <%if admin?%>
      <%= link_to 'Edit', edit_league_path(@league) %> |
      <%= link_to 'Settings', league_weeks_path(@league) %> |
  <%end%>
  <%= link_to 'All leagues', leagues_path %>

</div>


<script>
    function showTier(tier, all_tiers) {
        for (i = 1; i <= all_tiers; i++) {
            var visible = (i == tier || tier == 0);
            document.getElementById("show_tier"+i).style.display = (visible ? '' : 'none');
        }

    }
</script>



